!function(){"use strict";function e(){}function t(e){return e()}function r(){return Object.create(null)}function n(e){e.forEach(t)}function i(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e,t,r){const n=t.subscribe(r);e.$$.on_destroy.push(n.unsubscribe?()=>n.unsubscribe():n)}function s(e,t){e.appendChild(t)}function f(e,t,r){e.insertBefore(t,r)}function c(e){e.parentNode.removeChild(e)}function u(e,t){for(let r=0;r<e.length;r+=1)e[r]&&e[r].d(t)}function l(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function d(){return h(" ")}function p(e,t,r,n){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}function m(e,t,r){null==r?e.removeAttribute(t):e.setAttribute(t,r)}function g(e,t){t=""+t,e.data!==t&&(e.data=t)}function _(e,t,r){e.style.setProperty(t,r)}function v(e,t){for(let r=0;r<e.options.length;r+=1){const n=e.options[r];if(n.__value===t)return void(n.selected=!0)}}let y;function x(e){y=e}function b(e){(function(){if(!y)throw new Error("Function called outside component initialization");return y})().$$.on_mount.push(e)}const k=[],$=Promise.resolve();let w=!1;const C=[],E=[],I=[];function S(e){E.push(e)}function R(){const e=new Set;do{for(;k.length;){const e=k.shift();x(e),O(e.$$)}for(;C.length;)C.shift()();for(;E.length;){const t=E.pop();e.has(t)||(t(),e.add(t))}}while(k.length);for(;I.length;)I.pop()();w=!1}function O(e){e.fragment&&(e.update(e.dirty),n(e.before_render),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_render.forEach(S))}function N(e,r,o){const{fragment:a,on_mount:s,on_destroy:f,after_render:c}=e.$$;a.m(r,o),S(()=>{const r=s.map(t).filter(i);f?f.push(...r):n(r),e.$$.on_mount=[]}),c.forEach(S)}function j(e,t){e.$$.dirty||(k.push(e),w||(w=!0,$.then(R)),e.$$.dirty={}),e.$$.dirty[t]=!0}function T(t,i,o,a,s,f){const c=y;x(t);const u=i.props||{},l=t.$$={fragment:null,ctx:null,props:f,update:e,not_equal:s,bound:r(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(c?c.$$.context:[]),callbacks:r(),dirty:null};let h=!1;var d;l.ctx=o?o(t,u,(e,r)=>{l.ctx&&s(l.ctx[e],l.ctx[e]=r)&&(l.bound[e]&&l.bound[e](r),h&&j(t,e))}):u,l.update(),h=!0,n(l.before_render),l.fragment=a(l.ctx),i.target&&(i.hydrate?l.fragment.l((d=i.target,Array.from(d.childNodes))):l.fragment.c(),i.intro&&t.$$.fragment.i&&t.$$.fragment.i(),N(t,i.target,i.anchor),R()),x(c)}class D{$destroy(){var t,r;r=!0,(t=this).$$&&(n(t.$$.on_destroy),t.$$.fragment.d(r),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={}),this.$destroy=e}$on(e,t){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}$set(){}}var A={title:"American Community Survey 2017",subtitle:"Select tables for Connecticut by <a href='http://ctdata.org'>Connecticut Data Collaborative</a>",footer:"Connecticut Data Collaborative is a project of InformCT, Inc.<br>&copy; 2019 Connecticut Data Collaborative",defaultGeographyPath:"./geo/towns.geojson",extraGeographyPath:"./geo/tracts.geojson",extraGeographyName:"Census Tracts",geojsonGeographyProperty:"name",data:[{name:"Median Household Income",file:"./data/median_household_income.csv",prefix:"$",suffix:"",before:"ACS 2008-2012",beforemoe:!0,after:"ACS 2013-2017",aftermoe:!0,positiveIncrease:!0,description:"<b>The median increase in household income across all towns in Connecticut was 5.8%.</b> In 129 towns, median household income increased, most significant increases in North Canaan (+26,400, or +58%), Westbrook (+31,700, or +50%), and Southbury (+23,100, or +34%). Note that North Canaan and Westbrook both have large margins of errors due to small populations. In 40 towns, median household income decreased compared to 2008-2012 estimate, with the highest decreases occurring in Ansonia (~ -$9,200, or nearly -17%), New London (~ –$6,800, or -15%), and East Haddam (~ $13,000, or -14%). <b>Hartford remains the town with the lowest median household income in Connecticut</b> despite a 17% increase in median household income between ACS 2008-2012 and 2013-2017 estimates. New Haven median income increased 1.8% and changing its rank from 2nd to 3rd poorest municipality, while New London dropped from 7th to 2nd due to a 15% decrease."},{name:"Per Capita Income",file:"./data/per_capita_income.csv",prefix:"$",suffix:"",suffix:"",before:"ACS 2008-2012",beforemoe:!0,after:"ACS 2013-2017",aftermoe:!0,positiveIncrease:!0,description:"Per capita income increased in 142 municipalities and decreased in 27. <b>Hartford has the lowest per capita income at $19,220</b>, followed by Windham ($19,666), Waterbury ($21,605), Mansfield ($21,916), and Bridgeport ($22,806). New Canaan, Darien, and Westport are the towns with highest per capita income, all above $100,000."}]};function G(t,r=e){let n;const i=[];function a(e){if(o(t,e)){if(t=e,!n)return;i.forEach(e=>e[1]()),i.forEach(e=>e[0](t))}}return{set:a,update:function(e){a(e(t))},subscribe:function(o,s=e){const f=[o,s];return i.push(f),1===i.length&&(n=r(a)||e),o(t),()=>{const e=i.indexOf(f);-1!==e&&i.splice(e,1),0===i.length&&n()}}}}const F=G(!1),M=G(!1),z=G(!1),P=G(!1),B=G(!1),H=G(!1);function U(e){if(e)for(;/(\d+)(\d{3})/.test(e.toString());)e=e.toString().replace(/(\d+)(\d{3})/,"$1,$2");return e}const q=["#f6eff7","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],W=["#d73027","#f46d43","#fdae61","#d9ef8b","#91cf60","#1a9850"];function K(e){return!isNaN(parseFloat(e))&&isFinite(e)}function J(t){var r;return{c(){(r=l("div")).id=t.id,r.className="w-100 h-100"},m(e,t){f(e,r,t)},p(e,t){e.id&&(r.id=t.id)},i:e,o:e,d(e){e&&c(r)}}}function Q(e,t,r){let n,i,o;a(e,M,e=>{r("$jenksBreaks",n=e)}),a(e,H,e=>{r("$showChange",i=e)}),a(e,B,e=>{r("$geojsonPath",o=e)});let s,f,{id:c,time:u,col:l,extraGeography:h,positiveIncrease:d}=t,p=function(e){if(!e)return"#cccccc";let t=e[l],r=q,o=n;if(i&&"after"==l){let n=e.before;if(!K(n)||!K(t))return"#cccccc";t=(t-n)/n*100,o=[-100,-10,-5,0,5,10,100],r=W}if("-"===t)return"#cccccc";if("+"===t[t.length-1])return r[4];for(let e in o)if(e>0&&t<=o[e])return r[e-1];return"#cccccc"};const m=function(){s.fitBounds(f.getBounds())};return b(async function(){r("map",s=L.map(c,{center:[41.33,-72.65],zoom:9,zoomControl:!1,scrollWheelZoom:!1,attributionControl:!1})),s.keyboard.disable(),s.doubleClickZoom.disable(),s.dragging.disable()}),window.addEventListener("resize",m),e.$set=(e=>{"id"in e&&r("id",c=e.id),"time"in e&&r("time",u=e.time),"col"in e&&r("col",l=e.col),"extraGeography"in e&&r("extraGeography",h=e.extraGeography),"positiveIncrease"in e&&r("positiveIncrease",d=e.positiveIncrease)}),e.$$.update=((e={$geojsonPath:1,map:1,reloadGeojson:1})=>{(e.$geojsonPath||e.map||e.reloadGeojson)&&o&&s&&async function(){const e=await fetch(o),t=await e.json();f&&s.removeLayer(f),r("geojsonLayer",f=L.geoJson(t,{onEachFeature:function(e,t){t.on({mouseover:function(e){P.update(t=>e.target.feature.properties[A.geojsonGeographyProperty])},mouseout:function(e){P.update(e=>"")}})}}).addTo(s)),m(),z.subscribe(e=>{"map-after"==c&&H.subscribe(t=>{f.eachLayer(t=>{t.setStyle({fillColor:p(e[t.feature.properties[A.geojsonGeographyProperty]]),fillOpacity:1,color:"white",weight:1})})}),f.eachLayer(t=>{t.setStyle({fillColor:p(e[t.feature.properties[A.geojsonGeographyProperty]]),fillOpacity:1,color:"white",weight:1})})})}()}),{id:c,time:u,col:l,extraGeography:h,positiveIncrease:d}}class Z extends D{constructor(e){super(),T(this,e,Q,J,o,["id","time","col","extraGeography","positiveIncrease"])}}function Y(e,t,r){const n=Object.create(e);return n.color=t[r],n.i=r,n}function X(e){var t,r,n,i,o,a,u,p=0==e.i?"&leq;":"",m=4!=e.i?e.prefix+(e.$jenksBreaks[e.i+1]?U(e.$jenksBreaks[e.i+1]):"")+e.suffix:"",v=4==e.i?e.prefix+U(e.$jenksBreaks[e.i]+1)+e.suffix+"+":"";return{c(){t=l("div"),r=l("noscript"),n=d(),i=h(m),o=d(),a=h(v),u=d(),t.className="fl "+(e.i<4?"tr":"tl white")+" w-20 pv1 ph2 f6",_(t,"background-color",e.color)},m(e,c){f(e,t,c),s(t,r),r.insertAdjacentHTML("beforebegin",p),s(t,n),s(t,i),s(t,o),s(t,a),s(t,u)},p(e,r){(e.prefix||e.$jenksBreaks||e.suffix)&&m!==(m=4!=r.i?r.prefix+(r.$jenksBreaks[r.i+1]?U(r.$jenksBreaks[r.i+1]):"")+r.suffix:"")&&g(i,m),(e.prefix||e.$jenksBreaks||e.suffix)&&v!==(v=4==r.i?r.prefix+U(r.$jenksBreaks[r.i]+1)+r.suffix+"+":"")&&g(a,v),e.colorsJenks&&_(t,"background-color",r.color)},d(e){e&&c(t)}}}function V(t){for(var r,n=q,i=[],o=0;o<n.length;o+=1)i[o]=X(Y(t,n,o));return{c(){r=l("div");for(var e=0;e<i.length;e+=1)i[e].c();r.className="w-100"},m(e,t){f(e,r,t);for(var n=0;n<i.length;n+=1)i[n].m(r,null)},p(e,t){if(e.colorsJenks||e.prefix||e.comma||e.$jenksBreaks||e.suffix){n=q;for(var o=0;o<n.length;o+=1){const a=Y(t,n,o);i[o]?i[o].p(e,a):(i[o]=X(a),i[o].c(),i[o].m(r,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},i:e,o:e,d(e){e&&c(r),u(i,e)}}}function ee(e,t,r){let n;a(e,M,e=>{r("$jenksBreaks",n=e)});let{prefix:i,suffix:o}=t;return e.$set=(e=>{"prefix"in e&&r("prefix",i=e.prefix),"suffix"in e&&r("suffix",o=e.suffix)}),{prefix:i,suffix:o,$jenksBreaks:n}}class te extends D{constructor(e){super(),T(this,e,ee,V,o,["prefix","suffix"])}}function re(e){var t,r,n,i,o,a,u,p,m,_=e.value.toLocaleString(),v=e.moe&&ne(e);return{c(){t=l("p"),r=h(e.$ann),n=d(),i=l("p"),o=l("span"),a=h(e.prefix),u=h(_),p=h(e.suffix),m=d(),v&&v.c(),t.className="f4 mt0 mb1",o.className=e.color,i.className="f3 mv0"},m(e,c){f(e,t,c),s(t,r),f(e,n,c),f(e,i,c),s(i,o),s(o,a),s(o,u),s(i,p),s(i,m),v&&v.m(i,null)},p(e,t){e.$ann&&g(r,t.$ann),e.prefix&&g(a,t.prefix),e.value&&_!==(_=t.value.toLocaleString())&&g(u,_),e.color&&(o.className=t.color),e.suffix&&g(p,t.suffix),t.moe?v?v.p(e,t):((v=ne(t)).c(),v.m(i,null)):v&&(v.d(1),v=null)},d(e){e&&(c(t),c(n),c(i)),v&&v.d()}}}function ne(e){var t,r,n,i=e.$geo2data[e.$ann][e.col+"moe"].toLocaleString();return{c(){t=l("span"),r=h("± "),n=h(i),t.className="black-50"},m(e,i){f(e,t,i),s(t,r),s(t,n)},p(e,t){(e.$geo2data||e.$ann||e.col)&&i!==(i=t.$geo2data[t.$ann][t.col+"moe"].toLocaleString())&&g(n,i)},d(e){e&&c(t)}}}function ie(t){var r,n,i,o,a=t.$ann&&re(t);return{c(){r=l("div"),n=l("p"),i=h(t.period),o=d(),a&&a.c(),n.className="f6 black-80",r.className="w-100 tc h5",_(r,"margin-top","-150px")},m(e,t){f(e,r,t),s(r,n),s(n,i),s(r,o),a&&a.m(r,null)},p(e,t){e.period&&g(i,t.period),t.$ann?a?a.p(e,t):((a=re(t)).c(),a.m(r,null)):a&&(a.d(1),a=null)},i:e,o:e,d(e){e&&c(r),a&&a.d()}}}function oe(e,t,r){let n,i;a(e,z,e=>{r("$geo2data",n=e)}),a(e,P,e=>{r("$ann",i=e)});let{period:o,col:s,moe:f,prefix:c,suffix:u,positiveIncrease:l}=t,h="black",d="";return e.$set=(e=>{"period"in e&&r("period",o=e.period),"col"in e&&r("col",s=e.col),"moe"in e&&r("moe",f=e.moe),"prefix"in e&&r("prefix",c=e.prefix),"suffix"in e&&r("suffix",u=e.suffix),"positiveIncrease"in e&&r("positiveIncrease",l=e.positiveIncrease)}),e.$$.update=((e={$geo2data:1,$ann:1,col:1,value:1,positiveIncrease:1})=>{if((e.$geo2data||e.$ann||e.col||e.value||e.positiveIncrease)&&n[i]&&(r("value",d=n[i][s]),"after"==s)){let e=n[i].before;if(K(e)&&K(d)){let t=d-e;r("color",h=t>0&&l||t<0&&!l?"green":"red")}else r("color",h="black")}}),{period:o,col:s,moe:f,prefix:c,suffix:u,positiveIncrease:l,color:h,value:d,$geo2data:n,$ann:i}}class ae extends D{constructor(e){super(),T(this,e,oe,ie,o,["period","col","moe","prefix","suffix","positiveIncrease"])}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var se,fe=(function(e,t){e.exports=function e(){var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},r=!t.document&&!!t.postMessage,n=r&&/blob:/i.test((t.location||{}).protocol),i={},o=0,a={parse:function(r,n){var s=(n=n||{}).dynamicTyping||!1;if(b(s)&&(n.dynamicTypingFunction=s,s={}),n.dynamicTyping=s,n.transform=!!b(n.transform)&&n.transform,n.worker&&a.WORKERS_SUPPORTED){var f=function(){if(!a.WORKERS_SUPPORTED)return!1;var r,n,s=(r=t.URL||t.webkitURL||null,n=e.toString(),a.BLOB_URL||(a.BLOB_URL=r.createObjectURL(new Blob(["(",n,")();"],{type:"text/javascript"})))),f=new t.Worker(s);return f.onmessage=g,f.id=o++,i[f.id]=f}();return f.userStep=n.step,f.userChunk=n.chunk,f.userComplete=n.complete,f.userError=n.error,n.step=b(n.step),n.chunk=b(n.chunk),n.complete=b(n.complete),n.error=b(n.error),delete n.worker,void f.postMessage({input:r,config:n,workerId:f.id})}var d=null;return"string"==typeof r?d=n.download?new c(n):new l(n):!0===r.readable&&b(r.read)&&b(r.on)?d=new h(n):(t.File&&r instanceof File||r instanceof Object)&&(d=new u(n)),d.stream(r)},unparse:function(e,t){var r=!1,n=!0,i=",",o="\r\n",s='"',f=!1;"object"==typeof t&&("string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter(function(e){return-1!==t.delimiter.indexOf(e)}).length||(i=t.delimiter),("boolean"==typeof t.quotes||Array.isArray(t.quotes))&&(r=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(f=t.skipEmptyLines),"string"==typeof t.newline&&(o=t.newline),"string"==typeof t.quoteChar&&(s=t.quoteChar),"boolean"==typeof t.header&&(n=t.header));var c=new RegExp(s,"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return l(null,e,f);if("object"==typeof e[0])return l(u(e[0]),e,f)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:u(e.data[0])),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),l(e.fields||[],e.data||[],f);throw new Error("Unable to serialize unrecognized input");function u(e){if("object"!=typeof e)return[];var t=[];for(var r in e)t.push(r);return t}function l(e,t,r){var a="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var s=Array.isArray(e)&&0<e.length,f=!Array.isArray(t[0]);if(s&&n){for(var c=0;c<e.length;c++)0<c&&(a+=i),a+=h(e[c],c);0<t.length&&(a+=o)}for(var u=0;u<t.length;u++){var l=s?e.length:t[u].length,d=!1,p=s?0===Object.keys(t[u]).length:0===t[u].length;if(r&&!s&&(d="greedy"===r?""===t[u].join("").trim():1===t[u].length&&0===t[u][0].length),"greedy"===r&&s){for(var m=[],g=0;g<l;g++){var _=f?e[g]:g;m.push(t[u][_])}d=""===m.join("").trim()}if(!d){for(var v=0;v<l;v++){0<v&&!p&&(a+=i);var y=s&&f?e[v]:v;a+=h(t[u][y],v)}u<t.length-1&&(!r||0<l&&!p)&&(a+=o)}}return a}function h(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);e=e.toString().replace(c,s+s);var n="boolean"==typeof r&&r||Array.isArray(r)&&r[t]||function(e,t){for(var r=0;r<t.length;r++)if(-1<e.indexOf(t[r]))return!0;return!1}(e,a.BAD_DELIMITERS)||-1<e.indexOf(i)||" "===e.charAt(0)||" "===e.charAt(e.length-1);return n?s+e+s:e}}};if(a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!r&&!!t.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=m,a.ParserHandle=d,a.NetworkStreamer=c,a.FileStreamer=u,a.StringStreamer=l,a.ReadableStreamStreamer=h,t.jQuery){var s=t.jQuery;s.fn.parse=function(e){var r=e.config||{},n=[];return this.each(function(e){if("INPUT"!==s(this).prop("tagName").toUpperCase()||"file"!==s(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)n.push({file:this.files[i],inputElem:this,instanceConfig:s.extend({},r)})}),i(),this;function i(){if(0!==n.length){var t,r,i,f=n[0];if(b(e.before)){var c=e.before(f.file,f.inputElem);if("object"==typeof c){if("abort"===c.action)return t=f.file,r=f.inputElem,i=c.reason,void(b(e.error)&&e.error({name:"AbortError"},t,r,i));if("skip"===c.action)return void o();"object"==typeof c.config&&(f.instanceConfig=s.extend(f.instanceConfig,c.config))}else if("skip"===c)return void o()}var u=f.instanceConfig.complete;f.instanceConfig.complete=function(e){b(u)&&u(e,f.file,f.inputElem),o()},a.parse(f.file,f.instanceConfig)}else b(e.complete)&&e.complete()}function o(){n.splice(0,1),i()}}}function f(e){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=y(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new d(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,r){if(this.isFirstChunk&&b(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(e);void 0!==i&&(e=i)}this.isFirstChunk=!1;var o=this._partialLine+e;this._partialLine="";var s=this._handle.parse(o,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var f=s.meta.cursor;this._finished||(this._partialLine=o.substring(f-this._baseIndex),this._baseIndex=f),s&&s.data&&(this._rowCount+=s.data.length);var c=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(n)t.postMessage({results:s,workerId:a.WORKER_ID,finished:c});else if(b(this._config.chunk)&&!r){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return;s=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!c||!b(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),c||s&&s.meta.paused||this._nextChunk(),s}},this._sendError=function(e){b(this._config.error)?this._config.error(e):n&&this._config.error&&t.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function c(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),f.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=x(this._chunkLoaded,this),t.onerror=x(this._chunkError,this)),t.open("GET",this._input,!r),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var n in e)t.setRequestHeader(n,e[n])}if(this._config.chunkSize){var i=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+i)}try{t.send()}catch(e){this._chunkError(e.message)}r&&0===t.status?this._chunkError():this._start+=this._config.chunkSize}},this._chunkLoaded=function(){var e;4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._finished=!this._config.chunkSize||this._start>(null===(e=t.getResponseHeader("Content-Range"))?-1:parseInt(e.substr(e.lastIndexOf("/")+1))),this.parseChunk(t.responseText)))},this._chunkError=function(e){var r=t.statusText||e;this._sendError(new Error(r))}}function u(e){var t,r;(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),f.call(this,e);var n="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,n?((t=new FileReader).onload=x(this._chunkLoaded,this),t.onerror=x(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var i=Math.min(this._start+this._config.chunkSize,this._input.size);e=r.call(e,this._start,i)}var o=t.readAsText(e,this._config.encoding);n||this._chunkLoaded({target:{result:o}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function l(e){var t;f.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e=this._config.chunkSize,r=e?t.substr(0,e):t;return t=e?t.substr(e):"",this._finished=!t,this.parseChunk(r)}}}function h(e){f.call(this,e=e||{});var t=[],r=!0,n=!1;this.pause=function(){f.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){f.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=x(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}},this),this._streamError=x(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=x(function(){this._streamCleanUp(),n=!0,this._streamData("")},this),this._streamCleanUp=x(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function d(e){var t,r,n,i=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,o=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,s=this,f=0,c=0,u=!1,l=!1,h=[],d={data:[],errors:[],meta:{}};if(b(e.step)){var g=e.step;e.step=function(t){if(d=t,x())v();else{if(v(),0===d.data.length)return;f+=t.data.length,e.preview&&f>e.preview?r.abort():g(d,s)}}}function _(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function v(){if(d&&n&&($("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),n=!1),e.skipEmptyLines)for(var t=0;t<d.data.length;t++)_(d.data[t])&&d.data.splice(t--,1);return x()&&function(){if(d){for(var t=0;x()&&t<d.data.length;t++)for(var r=0;r<d.data[t].length;r++){var n=d.data[t][r];b(e.transformHeader)&&(n=e.transformHeader(n)),h.push(n)}d.data.splice(0,1)}}(),function(){if(!d||!e.header&&!e.dynamicTyping&&!e.transform)return d;for(var t=0;t<d.data.length;t++){var r,n=e.header?{}:[];for(r=0;r<d.data[t].length;r++){var i=r,o=d.data[t][r];e.header&&(i=r>=h.length?"__parsed_extra":h[r]),e.transform&&(o=e.transform(o,i)),o=k(i,o),"__parsed_extra"===i?(n[i]=n[i]||[],n[i].push(o)):n[i]=o}d.data[t]=n,e.header&&(r>h.length?$("FieldMismatch","TooManyFields","Too many fields: expected "+h.length+" fields but parsed "+r,c+t):r<h.length&&$("FieldMismatch","TooFewFields","Too few fields: expected "+h.length+" fields but parsed "+r,c+t))}return e.header&&d.meta&&(d.meta.fields=h),c+=d.data.length,d}()}function x(){return e.header&&0===h.length}function k(t,r){return n=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[n]&&(e.dynamicTyping[n]=e.dynamicTypingFunction(n)),!0===(e.dynamicTyping[n]||e.dynamicTyping)?"true"===r||"TRUE"===r||"false"!==r&&"FALSE"!==r&&(i.test(r)?parseFloat(r):o.test(r)?new Date(r):""===r?null:r):r;var n}function $(e,t,r,n){d.errors.push({type:e,code:t,message:r,row:n})}this.parse=function(i,o,s){var f=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substr(0,1048576);var r=new RegExp(p(t)+"([^]*?)"+p(t),"gm"),n=(e=e.replace(r,"")).split("\r"),i=e.split("\n"),o=1<i.length&&i[0].length<n[0].length;if(1===n.length||o)return"\n";for(var a=0,s=0;s<n.length;s++)"\n"===n[s][0]&&a++;return a>=n.length/2?"\r\n":"\r"}(i,f)),n=!1,e.delimiter)b(e.delimiter)&&(e.delimiter=e.delimiter(i),d.meta.delimiter=e.delimiter);else{var c=function(t,r,n,i){for(var o,s,f,c=[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP],u=0;u<c.length;u++){var l=c[u],h=0,d=0,p=0;f=void 0;for(var g=new m({comments:i,delimiter:l,newline:r,preview:10}).parse(t),v=0;v<g.data.length;v++)if(n&&_(g.data[v]))p++;else{var y=g.data[v].length;d+=y,void 0!==f?1<y&&(h+=Math.abs(y-f),f=y):f=y}0<g.data.length&&(d/=g.data.length-p),(void 0===s||h<s)&&1.99<d&&(s=h,o=l)}return{successful:!!(e.delimiter=o),bestDelimiter:o}}(i,e.newline,e.skipEmptyLines,e.comments);c.successful?e.delimiter=c.bestDelimiter:(n=!0,e.delimiter=a.DefaultDelimiter),d.meta.delimiter=e.delimiter}var l=y(e);return e.preview&&e.header&&l.preview++,t=i,r=new m(l),d=r.parse(t,o,s),v(),u?{meta:{paused:!0}}:d||{meta:{paused:!1}}},this.paused=function(){return u},this.pause=function(){u=!0,r.abort(),t=t.substr(r.getCharIndex())},this.resume=function(){u=!1,s.streamer.parseChunk(t,!0)},this.aborted=function(){return l},this.abort=function(){l=!0,r.abort(),d.meta.aborted=!0,b(e.complete)&&e.complete(d),t=""}}function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function m(e){var t,r=(e=e||{}).delimiter,n=e.newline,i=e.comments,o=e.step,s=e.preview,f=e.fastMode,c=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(c=e.escapeChar),("string"!=typeof r||-1<a.BAD_DELIMITERS.indexOf(r))&&(r=","),i===r)throw new Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||-1<a.BAD_DELIMITERS.indexOf(i))&&(i=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var u=0,l=!1;this.parse=function(e,a,h){if("string"!=typeof e)throw new Error("Input must be a string");var d=e.length,p=r.length,m=n.length,g=i.length,_=b(o),v=[],y=[],x=[],k=u=0;if(!e)return D();if(f||!1!==f&&-1===e.indexOf(t)){for(var $=e.split(n),w=0;w<$.length;w++){if(x=$[w],u+=x.length,w!==$.length-1)u+=n.length;else if(h)return D();if(!i||x.substr(0,g)!==i){if(_){if(v=[],O(x.split(r)),A(),l)return D()}else O(x.split(r));if(s&&s<=w)return v=v.slice(0,s),D(!0)}}return D()}for(var C,E=e.indexOf(r,u),I=e.indexOf(n,u),S=new RegExp(c.replace(/[-[\]\/{}()*+?.\\^$|]/g,"\\$&")+t,"g");;)if(e[u]!==t)if(i&&0===x.length&&e.substr(u,g)===i){if(-1===I)return D();u=I+m,I=e.indexOf(n,u),E=e.indexOf(r,u)}else if(-1!==E&&(E<I||-1===I))x.push(e.substring(u,E)),u=E+p,E=e.indexOf(r,u);else{if(-1===I)break;if(x.push(e.substring(u,I)),T(I+m),_&&(A(),l))return D();if(s&&v.length>=s)return D(!0)}else for(C=u,u++;;){if(-1===(C=e.indexOf(t,C+1)))return h||y.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:v.length,index:u}),j();if(C===d-1)return j(e.substring(u,C).replace(S,t));if(t!==c||e[C+1]!==c){if(t===c||0===C||e[C-1]!==c){var R=N(-1===I?E:Math.min(E,I));if(e[C+1+R]===r){x.push(e.substring(u,C).replace(S,t)),u=C+1+R+p,E=e.indexOf(r,u),I=e.indexOf(n,u);break}var L=N(I);if(e.substr(C+1+L,m)===n){if(x.push(e.substring(u,C).replace(S,t)),T(C+1+L+m),E=e.indexOf(r,u),_&&(A(),l))return D();if(s&&v.length>=s)return D(!0);break}y.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:v.length,index:u}),C++}}else C++}return j();function O(e){v.push(e),k=u}function N(t){var r=0;if(-1!==t){var n=e.substring(C+1,t);n&&""===n.trim()&&(r=n.length)}return r}function j(t){return h||(void 0===t&&(t=e.substr(u)),x.push(t),u=d,O(x),_&&A()),D()}function T(t){u=t,O(x),x=[],I=e.indexOf(n,u)}function D(e,t){return{data:t?v[0]:v,errors:y,meta:{delimiter:r,linebreak:n,aborted:l,truncated:!!e,cursor:k+(a||0)}}}function A(){o(D(void 0,!0)),v=[],y=[]}},this.abort=function(){l=!0},this.getCharIndex=function(){return u}}function g(e){var t=e.data,r=i[t.workerId],n=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var o={abort:function(){n=!0,_(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:v,resume:v};if(b(r.userStep)){for(var a=0;a<t.results.data.length&&(r.userStep({data:[t.results.data[a]],errors:t.results.errors,meta:t.results.meta},o),!n);a++);delete t.results}else b(r.userChunk)&&(r.userChunk(t.results,o,t.file),delete t.results)}t.finished&&!n&&_(t.workerId,t.results)}function _(e,t){var r=i[e];b(r.userComplete)&&r.userComplete(t),r.terminate(),delete i[e]}function v(){throw new Error("Not implemented.")}function y(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var r in e)t[r]=y(e[r]);return t}function x(e,t){return function(){e.apply(t,arguments)}}function b(e){return"function"==typeof e}return n&&(t.onmessage=function(e){var r=e.data;if(void 0===a.WORKER_ID&&r&&(a.WORKER_ID=r.workerId),"string"==typeof r.input)t.postMessage({workerId:a.WORKER_ID,results:a.parse(r.input,r.config),finished:!0});else if(t.File&&r.input instanceof File||r.input instanceof Object){var n=a.parse(r.input,r.config);n&&t.postMessage({workerId:a.WORKER_ID,results:n,finished:!0})}}),(c.prototype=Object.create(f.prototype)).constructor=c,(u.prototype=Object.create(f.prototype)).constructor=u,(l.prototype=Object.create(l.prototype)).constructor=l,(h.prototype=Object.create(f.prototype)).constructor=h,a}()}(se={exports:{}},se.exports),se.exports);function ce(e,t,r){const n=Object.create(e);return n.dp=t[r],n.i=r,n}function ue(t){var r,n,i=t.dp.name;return{c(){r=l("option"),n=h(i),r.__value=t.i,r.value=r.__value},m(e,t){f(e,r,t),s(r,n)},p:e,d(e){e&&c(r)}}}function le(e){for(var t,r,i,o,a,g,y,x,b,k,$,w,C,E,I,R,L,O,j,T,D,G,F,M,z,P,B,H,U,q,W,K,J,Q,Y,X,V,ee,re,ne,ie=A.title,oe=A.subtitle,se=A.extraGeographyName,fe=A.footer,le=A.data,de=[],pe=0;pe<le.length;pe+=1)de[pe]=ue(ce(e,le,pe));var me=new te({props:{prefix:e.prefix,suffix:e.suffix}}),ge=new Z({props:{id:"map-before",time:e.before,col:"before",extraGeography:e.extraGeography}}),_e=new Z({props:{id:"map-after",time:e.after,col:"after",positiveIncrease:e.positiveIncrease,extraGeography:e.extraGeography}}),ve=new ae({props:{col:"before",period:e.before,moe:e.beforemoe,prefix:e.prefix,suffix:e.suffix}}),ye=new ae({props:{col:"after",period:e.after,moe:e.aftermoe,prefix:e.prefix,suffix:e.suffix,positiveIncrease:e.positiveIncrease}});return{c(){t=l("div"),r=l("p"),i=d(),o=l("p"),a=d(),g=l("form"),y=l("select");for(var n=0;n<de.length;n+=1)de[n].c();x=d(),b=l("label"),k=l("input"),$=d(),w=h(se),C=d(),E=l("label"),I=l("input"),R=h(" Show Change"),L=d(),O=l("p"),j=l("a"),T=h("Download dataset"),G=h(" powering this visualization."),F=d(),M=l("p"),z=d(),P=l("div"),me.$$.fragment.c(),B=d(),H=l("div"),U=l("div"),ge.$$.fragment.c(),q=d(),W=l("div"),_e.$$.fragment.c(),K=d(),J=l("div"),Q=l("div"),ve.$$.fragment.c(),Y=d(),X=l("div"),ye.$$.fragment.c(),V=d(),ee=l("footer"),r.className="f3 f2-ns mb0",o.className="f5 f3-ns mt1",void 0===e.currentIndex&&S(()=>e.select_change_handler.call(y)),y.className="f6",m(k,"type","checkbox"),k.name="checkbox1",b.className="ml4",m(I,"type","checkbox"),I.name="checkbox2",E.className="ml4",g.className="boilerform pa3 bg-black-10",j.href=D=e.dp.file,j.className="link dim",O.className="black-80 f6",M.className="f6 lh-title",P.className="mw8 h3",t.className="mw9 center ph3",U.className="fl w-50 h-100",W.className="fl w-50 h-100",H.className="mw9 center ph3 cf",_(H,"height","600px"),Q.className="fl w-50",X.className="fl w-50",J.className="mw9 center ph3 mb5 h3",ee.className="w-100 center tc ph3 f6 mt5 pv5 black-80 bg-lightest-blue",ne=[p(y,"change",e.select_change_handler),p(k,"change",e.input0_change_handler),p(k,"change",e.handleExtraGeography),p(I,"change",he)]},m(n,c){f(n,t,c),s(t,r),r.innerHTML=ie,s(t,i),s(t,o),o.innerHTML=oe,s(t,a),s(t,g),s(g,y);for(var u=0;u<de.length;u+=1)de[u].m(y,null);v(y,e.currentIndex),s(g,x),s(g,b),s(b,k),k.checked=e.extraGeography,s(b,$),s(b,w),s(g,C),s(g,E),s(E,I),s(E,R),s(t,L),s(t,O),s(O,j),s(j,T),s(O,G),s(t,F),s(t,M),M.innerHTML=e.description,s(t,z),s(t,P),N(me,P,null),f(n,B,c),f(n,H,c),s(H,U),N(ge,U,null),s(H,q),s(H,W),N(_e,W,null),f(n,K,c),f(n,J,c),s(J,Q),N(ve,Q,null),s(J,Y),s(J,X),N(ye,X,null),f(n,V,c),f(n,ee,c),ee.innerHTML=fe,re=!0},p(e,t){if(e.config){le=A.data;for(var r=0;r<le.length;r+=1){const n=ce(t,le,r);de[r]?de[r].p(e,n):(de[r]=ue(n),de[r].c(),de[r].m(y,null))}for(;r<de.length;r+=1)de[r].d(1);de.length=le.length}e.currentIndex&&v(y,t.currentIndex),e.extraGeography&&(k.checked=t.extraGeography),re&&!e.dp||D===(D=t.dp.file)||(j.href=D),re&&!e.description||(M.innerHTML=t.description);var n={};e.prefix&&(n.prefix=t.prefix),e.suffix&&(n.suffix=t.suffix),me.$set(n);var i={};e.before&&(i.time=t.before),e.extraGeography&&(i.extraGeography=t.extraGeography),ge.$set(i);var o={};e.after&&(o.time=t.after),e.positiveIncrease&&(o.positiveIncrease=t.positiveIncrease),e.extraGeography&&(o.extraGeography=t.extraGeography),_e.$set(o);var a={};e.before&&(a.period=t.before),e.beforemoe&&(a.moe=t.beforemoe),e.prefix&&(a.prefix=t.prefix),e.suffix&&(a.suffix=t.suffix),ve.$set(a);var s={};e.after&&(s.period=t.after),e.aftermoe&&(s.moe=t.aftermoe),e.prefix&&(s.prefix=t.prefix),e.suffix&&(s.suffix=t.suffix),e.positiveIncrease&&(s.positiveIncrease=t.positiveIncrease),ye.$set(s)},i(e){re||(me.$$.fragment.i(e),ge.$$.fragment.i(e),_e.$$.fragment.i(e),ve.$$.fragment.i(e),ye.$$.fragment.i(e),re=!0)},o(e){me.$$.fragment.o(e),ge.$$.fragment.o(e),_e.$$.fragment.o(e),ve.$$.fragment.o(e),ye.$$.fragment.o(e),re=!1},d(e){e&&c(t),u(de,e),me.$destroy(),e&&(c(B),c(H)),ge.$destroy(),_e.$destroy(),e&&(c(K),c(J)),ve.$destroy(),ye.$destroy(),e&&(c(V),c(ee)),n(ne)}}}function he(){H.update(e=>!e)}function de(e,t,r){let n,i,o,a,s,f,c,u,l,h=0,d=!1;return B.update(e=>A.defaultGeographyPath),e.$$.update=((e={currentIndex:1,dp:1})=>{e.currentIndex&&r("dp",n=A.data[parseInt(h)]),e.dp&&r("description",i=n.description),e.dp&&r("before",o=n.before),e.dp&&r("after",a=n.after),e.dp&&r("beforemoe",s=n.beforemoe),e.dp&&r("aftermoe",f=n.aftermoe),e.dp&&r("prefix",c=n.prefix),e.dp&&r("suffix",u=n.suffix),e.dp&&r("positiveIncrease",l=n.positiveIncrease),e.dp&&fetch(n.file).then(function(e){return e.text()}).then(function(e){let t=fe.parse(e,{header:!0,dynamicTyping:!0}).data,r={};for(let e in t)r[t[e].geography]=t[e];let n=t.map(e=>parseFloat(e.before)||0),i=t.map(e=>parseFloat(e.after)||0);M.update(e=>(function(e,t){return t>e.length?null:function(e,t,r){var n=e.length-1,i=[],o=r;for(i[r]=e[e.length-1],i[0]=e[0];o>1;)i[o-1]=e[t[n][o]-2],n=t[n][o]-1,o--;return i}(e=e.slice().sort(function(e,t){return e-t}),function(e,t){var r,n,i=[],o=[],a=0;for(r=0;r<e.length+1;r++){var s=[],f=[];for(n=0;n<t+1;n++)s.push(0),f.push(0);i.push(s),o.push(f)}for(r=1;r<t+1;r++)for(i[1][r]=1,o[1][r]=0,n=2;n<e.length+1;n++)o[n][r]=1/0;for(var c=2;c<e.length+1;c++){for(var u=0,l=0,h=0,d=0,p=1;p<c+1;p++){var m=c-p+1,g=e[m-1];if(a=(l+=g*g)-(u+=g)*u/++h,0!=(d=m-1))for(n=2;n<t+1;n++)o[c][n]>=a+o[d][n-1]&&(i[c][n]=m,o[c][n]=a+o[d][n-1])}i[c][1]=1,o[c][1]=a}return{lower_class_limits:i,variance_combinations:o}}(e,t).lower_class_limits,t)})(n.concat(i),5)),z.update(e=>r),F.update(e=>t)})}),{currentIndex:h,extraGeography:d,handleExtraGeography:function(){B.update(e=>d?A.extraGeographyPath:A.defaultGeographyPath)},dp:n,description:i,before:o,after:a,beforemoe:s,aftermoe:f,prefix:c,suffix:u,positiveIncrease:l,select_change_handler:function(){h=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),r("currentIndex",h)},input0_change_handler:function(){d=this.checked,r("extraGeography",d)}}}new class extends D{constructor(e){super(),T(this,e,de,le,o,[])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
